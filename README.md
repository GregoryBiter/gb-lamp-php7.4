# GB-LAMP

Проект для запуска LAMP стека (Linux, Apache, MySQL, PHP) с использованием Docker Compose. Позволяет быстро развернуть локальную среду разработки с выбором версии PHP.

## Возможности

- **Выбор версии PHP**: Поддержка PHP 7.4, 8.0 и 8.2
- **Автоматическая настройка**: Инициализация проекта с копированием необходимых файлов
- **Управление контейнерами**: Запуск, остановка, логи и очистка
- **Ngrok интеграция**: Туннелирование для внешнего доступа
- **Гибкая конфигурация**: Настройка через файл `.env`
- **Автоматический запуск**: Скрипт `run.sh` для быстрого старта без ручной инициализации

## Требования

- Docker и Docker Compose
- Make (для использования команд из Makefile)
- Bash shell

## Установка и запуск

### Быстрый запуск (рекомендуется)

Используйте скрипт `run.sh` для автоматической инициализации и запуска:

```bash
./run.sh
```

Этот скрипт:

- Проверит и скопирует `docker-compose.yml` (по умолчанию для PHP 7.4)
- Создаст `.env` файл из `.env.example`, если он отсутствует
- Запустит `docker compose up -d`

### Ручная инициализация

1. **Инициализация проекта**:

   ```bash
   make init
   ```

   Выберите версию PHP (1 - PHP 7.4, 2 - PHP 8.0, 3 - PHP 8.2). Будет создан `docker-compose.yml` и предложено создать `.env`.

2. **Запуск проекта**:

   ```bash
   make up
   ```

## Конфигурация

### Файл .env

После инициализации отредактируйте файл `.env` для настройки:

- `VHOST_SERVER_NAME`: Доменное имя для виртуального хоста (например, `localhost` или `myproject.local`)
- Другие переменные окружения для MySQL, PHP и т.д.

Пример:

```bash
VHOST_SERVER_NAME=myproject.local
MYSQL_ROOT_PASSWORD=root
MYSQL_DATABASE=myproject
```

### Выбор версии PHP

Если нужно изменить версию PHP после инициализации:

1. Запустите `make init` снова и выберите новую версию

2. Или вручную скопируйте нужный шаблон:

   ```bash
   cp .docker/templates/php8.0/docker-compose.yml docker-compose.yml
   ```

### Добавление домена в hosts

Если `VHOST_SERVER_NAME` не `localhost`, добавьте запись в `/etc/hosts`:

```bash
127.0.0.1 myproject.local
```

Команда `make start` делает это автоматически.

## Доступ к сервисам

После запуска:

- **Веб-сервер**: [http://localhost](http://localhost) (или ваш `VHOST_SERVER_NAME`)
- **phpMyAdmin**: [http://localhost:8080](http://localhost:8080) (если настроено в docker-compose.yml)
- **MySQL**: localhost:3306

## Команды Makefile

- `make help`: Показать справку
- `make init`: Инициализировать проект с выбором PHP
- `make start`: Запустить с проверкой .env и добавлением хоста
- `make up`: Запустить Docker Compose в фоне
- `make down`: Остановить Docker Compose
- `make logs`: Показать логи
- `make clean`: Очистить контейнеры и образы
- `make ngrok`: Запустить ngrok для туннелирования

## Структура проекта

```bash
.
├── .docker/
│   ├── scripts/          # Скрипты инициализации и запуска
│   └── templates/        # Шаблоны docker-compose.yml для разных версий PHP
├── docker-compose.yml    # Конфигурация Docker Compose (создается при init)
├── .env                  # Переменные окружения (создается из .env.example)
├── .env.example          # Пример файла .env
├── Makefile              # Команды для управления проектом
└── run.sh                # Скрипт быстрого запуска
```

## Устранение неполадок

- **Ошибка "no configuration file provided"**: Запустите `make init` или используйте `./run.sh`
- **Проблемы с правами**: Запустите `make fix-permissions`
- **Контейнеры не запускаются**: Проверьте логи с `make logs`
- **Не удается подключиться к MySQL**: Проверьте настройки в `.env`

## Лицензия

[Укажите лицензию, если применимо]
